Ext.ns("Ext.trick","Ext.trick.app");
Ext.trick.app.Entry=function(){var me=this,apps={};return{add:function(app){var id=Ext.id(null,"OmegaTrickApp");apps[id]=new app;if(apps[id].appName){if(!window[apps[id].appName])window[apps[id].appName]={};Ext.applyIf(window[apps[id].appName],apps[id])}else{window[id]=apps[id];apps[id].appName=id}},remove:function(id){if(aps[id])delete apps[id]},removeLoadingMask:function(){var mask=Ext.get("OMEGATRICK_LOADINGMASK"),logo=Ext.get("OMEGATRICK_LOADING_LOGO"),progress=Ext.get("OMEGATRICK_LOADING_PROGRESS");
if(logo)logo.fadeOut();if(progress)progress.fadeOut({callback:function(){progress.remove();if(mask)mask.fadeOut()}})},showLoadText:function(o){var wrap=Ext.get("OMEGATRICK_LOADING_PROGRESS"),config=o||{};if(config.anim===false)wrap.show();else wrap.fadeIn(config)},hideLoadText:function(o){var wrap=Ext.get("OMEGATRICK_LOADING_PROGRESS"),config=o||{};if(config.anim===false)wrap.hide();else wrap.fadeOut(config)},updateLoadText:function(text){var wrap=Ext.get("OMEGATRICK_LOADING_PROGRESS"),to=Ext.get("OMEGATRICK_LOADING_PROGRESS_MSG"),
tm=Ext.util.TextMetrics.createInstance(wrap),width=tm.getWidth(text)+10;wrap.setWidth(width);wrap.setStyle({marginLeft:"-"+width/2+"px"});to.update(text)},boot:function(){Ext.iterate(apps,function(key,item,items){item.init()})}}}();Ext.onReady(Ext.trick.app.Entry.boot);Ext.onTrick=function(o){return Ext.trick.app.Entry.add(Ext.extend(Ext.trick.app.App,o))};Ext.ns("Ext.trick","Ext.trick.app","Ext.trick.layout","Ext.trick.unit","Ext.trick.util");
Ext.trick.app.App=Ext.extend(Ext.util.Observable,{appName:null,autoRender:true,screenXTypePrefix:"",widgets:{},screens:[],casing:{},initEvents:function(){var me=this,cp=me.cp,akey=cp.get("autosigninkey");me.addEvents("beforeinit","init","beforestart","start","beforeloadscript","loadscript");me.on("init",me.removeScriptTags,me);if(me.auth)if(akey)me.on("init",me.doAutoSignin);else me.on("init",me.doAuth);else{me.on("init",Ext.trick.app.Entry.removeLoadingMask);if(me.autoRender)me.on("init",me.render,
me);else me.on("init",me.start,me)}},signout:function(o){var me=this,config=o||{},arg=[],auth=eval(me.auth.directFn);if(config.callback){arg.push(config.callback);if(config.scope)arg.push(config.scope)}auth.signout.apply(me,arg)},doAutoSignin:function(){var me=this,cp=me.cp,akey=cp.get("autosigninkey");auth=eval(me.auth.directFn);auth.autoSignin(akey,function(ret){if(ret.success)cp.set("autosigninkey",ret.auto_signin_key);else;me.doAuth()},me)},doAuth:function(){var me=this,cp=me.cp,akey=cp.get("autosigninkey");
auth=eval(me.auth.directFn);Ext.trick.app.Entry.updateLoadText("\u8a8d\u8a3c\u78ba\u8a8d\u4e2d...");auth.isSignin(function(ret){if(!ret)Ext.trick.app.Entry.hideLoadText({anim:true,callback:function(){me.widgets.signin=new Ext.trick.SigninWindow;me.widgets.signin.on("hide",function(ret){var autoSignin=ret.autoSignin;Ext.trick.app.Entry.updateLoadText("\u8a8d\u8a3c\u78ba\u8a8d\u4e2d...");Ext.trick.app.Entry.showLoadText({anim:true,callback:function(){auth.execute(ret,function(ret){Ext.trick.app.Entry.hideLoadText({anim:true,
callback:function(){if(ret.success){if(autoSignin)cp.set("autosigninkey",ret.auto_signin_key);Ext.trick.app.Entry.removeLoadingMask();if(me.autoRender)me.render();else me.start()}else{Ext.trick.app.Entry.hideLoadText();Ext.MessageBox.show({title:Ext.trick.SigninWindow.msg.signin.title,msg:Ext.trick.SigninWindow.msg.signin.auth.error,buttons:Ext.MessageBox.OK,modal:false,fn:function(){me.widgets.signin.show()},icon:Ext.MessageBox.ERROR})}},scope:me})},me)},scope:me})},me);me.widgets.signin.show()},
scope:me});else{Ext.trick.app.Entry.removeLoadingMask();if(me.autoRender)me.render();else me.start()}})},removeScriptTags:function(){var me=this;Ext.select("body script").each(function(el){Ext.removeNode(Ext.getDom(el))},me)},screenTo:function(to){var me=this,sp=Ext.getCmp(me.appName+"_SCREEN"),t;if(Ext.isNumber(to))Ext.iterate(sp.initialConfig.items,function(item,cnt,items){if(to===cnt)t=item});if(Ext.isString(to))Ext.iterate(sp.initialConfig.items,function(item,cnt,items){if(to===item.id)t=item});
if(t&&t.fix)sp.layout.setActiveItem(to);else sp.layout.setActiveItem(to)},init:function(){var me=this;Ext.QuickTips.init();me.cp=new Ext.state.CookieProvider({expires:new Date((new Date).getTime()+1E3*60*60*24*7)});me.initEvents();if(!me.fireEvent("beforeinit"))return false;if(me.useDirect)Ext.Direct.addProvider(me.useDirect);me.fireEvent("init")},render:function(){var me=this,renderItems;var screens=[];Ext.iterate(me.screens,function(item,cnt,items){var o={name:item.name,xtype:me.screenXTypePrefix+
item.name.toLowerCase()};if(item.items)o.scriptItems=item.items;if(item.fix)o.fix=true;if(item.id)o.id=item.id;screens.push(o)},me);renderItems=[{id:me.appName+"_SCREEN",xtype:"screen",items:screens,region:"center"}];if(Ext.isObject(me.casing)&&me.casing.north){var north=me.casing.north;north.region="north";renderItems.push(north)}if(Ext.isObject(me.casing)&&me.casing.west){var west=me.casing.west;west.region="west";renderItems.push(west)}if(Ext.isObject(me.casing)&&me.casing.east){var east=me.casing.east;
east.region="east";renderItems.push(east)}if(Ext.isObject(me.casing)&&me.casing.south){var south=me.casing.south;south.region="east";renderItems.push(south)}me.viewport=new Ext.Viewport({layout:"fit",items:[{border:false,layout:"border",items:renderItems}],listeners:{afterrender:{fn:function(){me.start.call(me)}}}})},start:Ext.emptyFn});Ext.trick.SigninWindow=Ext.extend(Ext.Component,{initComponent:function(){var me=this;Ext.applyIf(me,{id:Ext.id(),baseCls:"tx-signin",duration:0.3,distance:75});me.layer=new Ext.Layer({id:me.id,cls:me.baseCls});Ext.apply(me,{id:Ext.id(),bwrapCls:me.baseCls+"-bwrap",bodyCls:me.baseCls+"-body",innerCls:me.baseCls+"-inner",itemsCls:me.baseCls+"-items",headerCls:me.baseCls+"-header",contentCls:me.baseCls+"-content",renderTo:me.layer});Ext.EventManager.onWindowResize(me.onWindowResize,me);Ext.trick.SigninWindow.superclass.initComponent.call(me)},
initEvents:function(){},onRender:function(ct,position){var me=this,dh=Ext.DomHelper;Ext.trick.SigninWindow.superclass.onRender.call(me,ct,position);var el=me.el;el.addClass(me.bwrapCls);var t=new Ext.Template('<div class="{bodyCls}">','   <div class="{innerCls}">','       <div class="clearfix">','           <div id={itemsId} class="{itemsCls} clearfix">','               <div class="{headerCls}">','                   <div class="title"></div>',"               </div>",'               <div class="clearfix">',
'                   <div class="{contentCls}">','                       <div class="form">','                           <div class="mail">','                               <div class="label"></div>',"                           </div>",'                           <div class="textfield space" id="{emailId}"></div>','                           <div class="pass">','                               <div class="label"></div>',"                           </div>",'                           <div class="textfield space" id="{passId}"></div>',
"                        </div>",'                        <div class="autologin clearfix">','                            <div class="auto" id="{checkboxId}"></div>','                            <div class="btn_siginin" id="{submitId}"></div>',"                        </div>",'                        <div class="fogetpass clearfix">','                            <a href="#" class="fogetpass">{msgFogetPass}</a>',"                        </div>","                    </div>","                </div>",
"           </div>","       </div>","   </div>","</div>");t.append(el,{bodyCls:me.bodyCls,innerCls:me.innerCls,itemsCls:me.itemsCls,headerCls:me.headerCls,contentCls:me.contentCls,itemsId:el.id+"_SIGNIN_ITEMS",emailId:el.id+"_FIELD_EMAIL",passId:el.id+"_FIELD_PASSWORD",checkboxId:el.id+"_FIELD_CHECKBOX",submitId:el.id+"_FIELD_SUBMIT",msgFogetPass:Ext.trick.SigninWindow.msg.signin.fogetpass});Ext.fly(el.id+"_SIGNIN_ITEMS").setOpacity(0);me.email=new Ext.form.TextField({width:280,height:28,tabIndex:1,
vtype:"email",enableKeyEvents:true,validationEvent:false,validator:function(v){if(v=="")return Ext.trick.SigninWindow.msg.signin.validate.email;return true},listeners:{keypress:{fn:function(field,e){if(e.getKey()===e.ENTER)me.onSignin()},scope:me}},renderTo:Ext.get(el.id+"_FIELD_EMAIL")});me.password=new Ext.form.TextField({width:280,height:28,inputType:"password",tabIndex:2,enableKeyEvents:true,listeners:{keypress:{fn:function(field,e){if(e.getKey()===e.ENTER)me.onSignin()},scope:me}},renderTo:Ext.get(el.id+
"_FIELD_PASSWORD")});me.autosignin=new Ext.form.Checkbox({boxLabel:Ext.trick.SigninWindow.msg.signin.autosignin,tabIndex:3,renderTo:Ext.get(el.id+"_FIELD_CHECKBOX")});me.submit=new Ext.Button({text:Ext.trick.SigninWindow.msg.signin.submit,width:100,type:"submit",tabIndex:4,plugins:["focusactive"],handler:me.onSignin,scope:me,renderTo:el.id+"_FIELD_SUBMIT"});this.rendered=true;me.initEvents()},onSignin:function(){var me=this;me.email.disable();me.password.disable();me.hide()},getCenterPosition:function(){var me=
this,vs=Ext.getDoc().getViewSize();return{x:(vs.width-me.layer.getWidth())/2,y:(vs.height-me.layer.getHeight())/2}},show:function(){var me=this,cp=me.getCenterPosition();me.layer.setLeft(cp.x+me.distance);me.layer.setTop(cp.y);me.layer.setOpacity(0);me.layer.show();me.layer.shift({x:cp.x,easing:"easeOutStrong",opacity:1,duration:me.duration,callback:function(){Ext.fly(me.el.id+"_SIGNIN_ITEMS").fadeIn({duration:me.duration,callback:function(){me.email.enable();me.password.enable();me.email.focus();
me.fireEvent("show",me)}})}})},hide:function(){var me=this,cp=me.getCenterPosition();me.layer.shift({x:cp.x-me.distance,easing:"easeOutStrong",opacity:0,duration:me.duration,callback:function(){Ext.fly(me.el.id+"_SIGNIN_ITEMS").setOpacity(0);me.fireEvent("hide",{email:me.email.getValue(),pass:me.password.getValue(),autoSignin:me.autosignin.getValue()},me)}})},onWindowResize:function(w,h){var me=this,vs=Ext.getDoc().getViewSize(),cwp=(vs.width-me.layer.getWidth())/2,chp=(vs.height-me.layer.getHeight())/
2;if(me.isVisible){me.layer.setLeft(cwp);me.layer.setTop(chp)}}});
Ext.trick.SigninWindow.msg={signin:{title:"\u30b5\u30a4\u30f3\u30a4\u30f3",progress:"\u30b5\u30a4\u30f3\u30a4\u30f3\u4e2d...",fogetpass:"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u304a\u5fd8\u308c\u3067\u3059\u304b ?",autosignin:"\u6b21\u56de\u304b\u3089\u81ea\u52d5\u30b5\u30a4\u30f3\u30a4\u30f3",submit:"\u30b5\u30a4\u30f3\u30a4\u30f3",auth:{error:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u307e\u305f\u306f\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u9055\u3044\u307e\u3059\u3002"},validate:{email:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}}};Ext.ns("Ext.trick","Ext.trick.plugins");Ext.ns("Ext.trick","Ext.trick.plugins");
Ext.trick.plugins.FocusActive=function(){var me=this;var overCls="x-btn-over";var active=false;me.init=function(btn){btn.on({afterrender:{fn:function(){me.targetEl=btn.el;btn.btnEl.on("focus",me.onFocus,me);btn.btnEl.on("blur",me.onBlur,me)},scope:me},mouseout:{fn:function(){if(active)me.targetEl.addClass(overCls)},scope:me}})};me.onFocus=function(e,t){active=true;me.targetEl.addClass(overCls)};me.onBlur=function(e,t){me.targetEl.removeClass(overCls);active=false}};Ext.preg("focusactive",Ext.trick.plugins.FocusActive);Ext.ns("Ext.trick","Ext.trick.util");Ext.trick.util.Clone=function(o){if(!o||"object"!==typeof o)return o;var c="[object Array]"===Object.prototype.toString.call(o)?[]:{};var p,v;for(p in o)if(o.hasOwnProperty(p)){v=o[p];if(v&&"object"===typeof v)c[p]=Ext.trick.util.Clone(v);else c[p]=v}return c};Ext.ns("Ext.trick","Ext.trick.util");Ext.ns("Ext.trick","Ext.trick.util");Ext.trick.util.ScriptLoader=function(config){var me=this;Ext.apply(me,config);me.initEvents();Ext.trick.util.ScriptLoader.superclass.constructor.call(me)};
Ext.extend(Ext.trick.util.ScriptLoader,Ext.util.Observable,{initEvents:function(){this.addEvents("load","next")},load:function(){var me=this,load=false;if(Ext.isObject(me.items)){me.items=[me.items];load=true}var item=me.items.shift();if(item)me._load(item);else me.fireEvent("load",me)},_load:function(item){var me=this;var te=me.renderTo||document.body||document.documentElement;var script=document.createElement("script");script.id=item.id||Ext.id();script.src=item.src;script.type=item.type||"text/javascript";
if(item.charset)script.charset=item.charset;if(Ext.isIE)script.onreadystatechange=function(){switch(script.readyState){case "complete":case "loaded":if(item.callback)item.callback.apply(item.scope||me,[script.id,me]);me.load();break;default:break}};Ext.get(te.appendChild(script)).on("load",function(e,t){if(item.callback)item.callback.apply(item.scope||me,[script.id,me]);me.load()},me)}});Ext.ns("Ext.trick","Ext.trick.form");
Ext.trick.form.FormPanel=Ext.extend(Ext.form.FormPanel,{defaultType:"container",initComponent:function(){var me=this;me.setDeepLayout(me.initialConfig.items);Ext.trick.form.FormPanel.superclass.initComponent.apply(me,arguments);me.forms={};me.scanFormItems(me.items)},setDeepLayout:function(items){var me=this;Ext.each(items,function(item,cnt,items){if(!item.layout)item.layout="form";if(item.items&&item.items.length>0)me.setDeepLayout(item.items)},me)},scanFormItems:function(items){var me=this;items.each(function(item,
index,length){if(item instanceof Ext.form.Field)me.forms[item.name||item.id]=item;if(item.items&&item.items.getCount()>0)me.scanFormItems(item.items)},me)}});Ext.reg("advform",Ext.trick.form.FormPanel);Ext.ns("Ext.trick","Ext.trick.layout");
Ext.trick.layout.ScreenLayout=Ext.extend(Ext.layout.FitLayout,{deferredRender:false,layoutOnCardChange:false,renderHidden:true,constructor:function(config){Ext.trick.layout.ScreenLayout.superclass.constructor.call(this,config)},destroyFlexItems:function(){var me=this,c=me.container,ci=c.items,ic=c.initialConfig,ici=ic.items;Ext.iterate(ci.items,function(item,cnt,items){if(!item.fix)item.destroy();else item.hide()})},setActiveItem:function(item){var me=this,c=me.container,ci=c.items,ic=c.initialConfig,
ici=ic.items,ai=me.activeItem,oi=item;var si;me.destroyFlexItems();if(Ext.isNumber(item))if(ci.items[item])si=ci.items[item];else si=c.add(ici[item]);else if(Ext.isString(item)){var id=item;Ext.iterate(ci.items,function(item,cnt,items){if(item.id===id)si=item});if(!si)Ext.iterate(ici,function(item,cnt,items){if(item.id===id)si=c.add(item)})}else{var target=item;Ext.iterate(ci.items,function(item,cnt,items){if(item===target)si=item})}if(si){si.show();me.activeItem=si}me.layout();if(si)si.doLayout();
si.fireEvent("activate",si)},renderAll:function(ct,target){var me=this;if(me.deferredRender)me.renderItem(me.activeItem,undefined,target);else Ext.trick.layout.ScreenLayout.superclass.renderAll.call(me,ct,target)}});Ext.Container.LAYOUTS["screen"]=Ext.trick.layout.ScreenLayout;Ext.ns("Ext.trick");
Ext.trick.ScreenPanel=Ext.extend(Ext.Panel,{initComponent:function(){var me=this;Ext.applyIf(me,{layout:"screen"});if(me.layout==="screen")Ext.applyIf(me,{activeItem:0});Ext.trick.ScreenPanel.superclass.initComponent.call(this)},add:function(comp,num){var me=this;me.initItems();var args=arguments.length>1;if(args||Ext.isArray(comp)){var result=[];Ext.each(args?arguments:comp,function(c,num){if(num==me.activeItem||c.id==me.activeItem)result.push(me.add(c))},me);return result}var c=me.lookupComponent(me.applyDefaults(comp));
var index=this.items.length;if(me.fireEvent("beforeadd",me,c,index)!==false&&me.onBeforeAdd(c)!==false){me.items.add(c);c.onAdded(me,index);me.onAdd(c);me.fireEvent("add",me,c,index)}return c}});Ext.reg("screen",Ext.trick.ScreenPanel);Ext.ns("Ext.trick");Ext.trick.Config=function(){var testingFrameworkName="yui";return{getTestingFrameworkName:function(){return testingFrameworkName},setTestingFrameworkName:function(name){testingFrameworkName=name}}}();String.prototype.endsWith=function(suffix){var sub=this.length-suffix.length;return sub>=0&&this.lastIndexOf(suffix)===sub};Ext.applyIf(Ext,{maxZindex:function(){var ret=0;var els=Ext.select("*");els.each(function(el){var zIndex=el.getStyle("z-index");if(Ext.isNumber(parseInt(zIndex))&&ret<zIndex)ret=zIndex},this);return ret},getScrollPos:function(){var y=document.documentElement.scrollTop>0?document.documentElement.scrollTop:document.body.scrollTop;var x=document.documentElement.scrollLeft>0?document.documentElement.scrollLeft:document.body.scrollLeft;return{x:x,y:y}},clone:function(o){return Ext.trick.util.Clone(o)}});
